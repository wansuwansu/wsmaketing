<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOSPITAL MARKETING PRO</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #0E1117; color: #E6EDF3; }
        
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #161B22; }
        ::-webkit-scrollbar-thumb { background: #30363D; border-radius: 4px; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-active { border-bottom: 2px solid #58A6FF; color: #FFFFFF; font-weight: bold; }
        .tab-inactive { color: #8B949E; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { background-color: #161B22; border: 1px solid #30363D; border-radius: 8px; padding: 20px; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-primary { background-color: #238636; color: white; transition: 0.2s; }
        .btn-primary:hover { background-color: #2EA043; }
        .btn-secondary { background-color: #21262D; border: 1px solid #30363D; color: #C9D1D9; }
        .btn-active { background-color: #1F6FEB; color: white; border: none; }
        
        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        input, select { background-color: #0D1117; border: 1px solid #30363D; color: white; padding: 10px; border-radius: 6px; width: 100%; }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; }
        th { background-color: #161B22; color: #8B949E; padding: 12px; text-align: left; font-size: 0.9rem; border-bottom: 1px solid #30363D; }
        td { padding: 12px; border-bottom: 1px solid #30363D; font-size: 0.9rem; }
        tr:hover { background-color: #1F242C; }
        a { color: #58A6FF; text-decoration: none; }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #58A6FF; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- [ì„¤ì •] í‚¤ì›Œë“œ í™•ì¥ ë¦¬ìŠ¤íŠ¸ ---
        const KEYWORD_EXPANSION = {
            "í”¼ë¶€ê³¼": ["í”¼ë¶€ê³¼", "í”¼ë¶€ê³¼ì¶”ì²œ", "í”¼ë¶€ê³¼ì „ë¬¸ì˜", "ì•¼ê°„ì§„ë£Œ"],
            "ì„±í˜•ì™¸ê³¼": ["ì„±í˜•ì™¸ê³¼", "ëˆˆì„±í˜•", "ì½”ì„±í˜•", "ì¬ìˆ˜ìˆ "],
            "ë¦¬í”„íŒ…": ["ë¦¬í”„íŒ…", "ìš¸ì„ë¼", "ì¨ë§ˆì§€", "ì¸ëª¨ë“œ", "ìŠˆë§í¬", "ì˜¬ë¦¬ì§€ì˜¤", "í…ì¨ë§ˆ", "í‹°íƒ€ëŠ„"],
            "ìŠ¤í‚¨ë¶€ìŠ¤í„°": ["ìŠ¤í‚¨ë¶€ìŠ¤í„°", "ë¦¬ì¥¬ë€", "ì¥¬ë² ë£©", "ì—‘ì†Œì¢€", "ìŠ¤í‚¨ë°”ì´ë¸Œ"],
            "ì—¬ë“œë¦„": ["ì—¬ë“œë¦„", "ì—¬ë“œë¦„í‰í„°", "ì•„ì¿ ì•„í•„", "PDT", "ì••ì¶œ"],
            "ì œëª¨": ["ì œëª¨", "ë ˆì´ì €ì œëª¨", "ì•„í¬ì§€", "ì  í‹€ë§¥ìŠ¤"],
            "ë‹¤ì´ì–´íŠ¸": ["ë‹¤ì´ì–´íŠ¸", "ì§€ë°©ë¶„í•´ì£¼ì‚¬", "ì‚­ì„¼ë‹¤", "ëŒìŠ¤"],
            "íƒˆëª¨": ["íƒˆëª¨", "ëª¨ë°œì´ì‹", "ë‘í”¼ê´€ë¦¬"],
            "í•œì˜ì›": ["í•œì˜ì›", "êµí†µì‚¬ê³ ", "ì¶”ë‚˜ìš”ë²•", "ë‹¤ì´ì–´íŠ¸í•œì•½"],
            "ë·°í‹°": ["ì—ìŠ¤í…Œí‹±", "ê²½ë½", "ìœ¤ê³½ê´€ë¦¬", "ì‹ ë¶€ê´€ë¦¬"]
        };

        // --- [ìœ í‹¸] ë‚ ì§œ ê³„ì‚° ë° ìˆ«ì í¬ë§· ---
        const getDaysAgo = (dateStr) => {
            if(!dateStr) return 999;
            const postDate = new Date(dateStr.slice(0,4), dateStr.slice(4,6)-1, dateStr.slice(6,8));
            const now = new Date();
            const diff = now - postDate;
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        };

        const formatNumber = (num) => {
            if(num >= 10000) return (num/10000).toFixed(1) + 'ë§Œ';
            if(num >= 1000) return (num/1000).toFixed(1) + 'ì²œ';
            return num;
        };

        // --- [ë¡œì§] ë¸”ë¡œê·¸ ë“±ê¸‰ ê³„ì‚° ---
        const calculateBlogRank = (rank, daysAgo) => {
            if (rank <= 5) {
                if (daysAgo <= 30) return "ğŸ‘‘ S+ (ìµœì‹  ìµœì )";
                if (daysAgo <= 180) return "ğŸ† S (ìƒìœ„ ë…¸ì¶œ)";
                return "ğŸ›¡ï¸ S- (ì•Œë°•ê¸°)";
            } else if (rank <= 15) {
                if (daysAgo <= 30) return "ğŸš€ A+ (ê¸‰ìƒìŠ¹)";
                if (daysAgo <= 180) return "ğŸ¥‡ A (ìš°ìˆ˜)";
                return "ğŸ’¤ A- (ìœ ì§€)";
            } else if (rank <= 30) {
                return "ğŸ¥ˆ B (ì¤€ìˆ˜)";
            } else {
                return "ğŸŒ± C (ì¼ë°˜)";
            }
        };

        // --- [ì»´í¬ë„ŒíŠ¸] ë©”ì¸ ì•± ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('blog');
            const [apiKeys, setApiKeys] = useState({ naverId: '', naverSecret: '', youtubeKey: '' });
            
            // ë¸”ë¡œê·¸ ìƒíƒœ
            const [blogInputs, setBlogInputs] = useState({ region: 'ë¶„ë‹¹', category: 'í”¼ë¶€ê³¼' });
            const [blogData, setBlogData] = useState([]);
            const [blogLoading, setBlogLoading] = useState(false);
            const [selectedKeyword, setSelectedKeyword] = useState("ALL");
            const [periodFilter, setPeriodFilter] = useState("all"); // all, recent, revisit, long, old

            // ìœ íŠœë¸Œ ìƒíƒœ
            const [ytInputs, setYtInputs] = useState({ keyword: 'í”¼ë¶€ê³¼ í›„ê¸°' });
            const [ytData, setYtData] = useState([]);
            const [ytLoading, setYtLoading] = useState(false);

            // --- API í˜¸ì¶œ í•¨ìˆ˜: ë¸”ë¡œê·¸ ---
            const fetchBlogs = async () => {
                if (!apiKeys.naverId || !apiKeys.naverSecret) {
                    alert("ë„¤ì´ë²„ API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!");
                    return;
                }
                setBlogLoading(true);
                setBlogData([]);

                const mainKw = `${blogInputs.region} ${blogInputs.category}`;
                const subKws = (KEYWORD_EXPANSION[blogInputs.category] || []).map(k => `${blogInputs.region} ${k}`);
                const allKws = [mainKw, ...subKws]; // ê²€ìƒ‰ ìˆ˜ ì œí•œ ì—†ì´ ì „ì²´

                let allResults = [];

                try {
                    // ë¹„ë™ê¸° ë³‘ë ¬ ì²˜ë¦¬ëŠ” API ì œí•œ ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìˆœì°¨ ì²˜ë¦¬ ë˜ëŠ” Promise.all ì œí•œ
                    // ì—¬ê¸°ì„  ê°„ë‹¨í•˜ê²Œ 5ê°œë§Œ ì‹œë²”ì ìœ¼ë¡œ (CORS ì´ìŠˆ ëŒ€ë¹„)
                    for (const kw of allKws.slice(0, 5)) { 
                        const url = `https://openapi.naver.com/v1/search/blog.json?query=${encodeURIComponent(kw)}&display=20&sort=sim`;
                        const res = await fetch(url, {
                            headers: {
                                "X-Naver-Client-Id": apiKeys.naverId,
                                "X-Naver-Client-Secret": apiKeys.naverSecret
                            }
                        });
                        const data = await res.json();
                        
                        if (data.items) {
                            const processed = data.items.map((item, idx) => {
                                const rank = idx + 1;
                                const days = getDaysAgo(item.postdate);
                                return {
                                    keyword: kw,
                                    rank: rank,
                                    title: item.title.replace(/<[^>]*>?/g, ''),
                                    blogName: item.bloggername,
                                    link: item.link,
                                    postdate: item.postdate,
                                    daysAgo: days,
                                    tier: calculateBlogRank(rank, days),
                                    type: (item.bloggername.includes('ê³µì‹') || item.bloggername.includes('ë³‘ì›')) ? "ğŸ¥ ë³‘ì›ê³µì‹" : "ğŸ‘¤ ì¼ë°˜"
                                };
                            });
                            allResults = [...allResults, ...processed];
                        }
                    }
                    // ì¤‘ë³µ ì œê±° (ë§í¬ ê¸°ì¤€)
                    const uniqueResults = Array.from(new Set(allResults.map(a => a.link)))
                        .map(link => allResults.find(a => a.link === link));
                    
                    setBlogData(uniqueResults);
                    setSelectedKeyword("ALL");
                } catch (error) {
                    console.error(error);
                    alert("API í˜¸ì¶œ ì‹¤íŒ¨! CORS í™•ì¥í”„ë¡œê·¸ë¨ì„ í™•ì¸í•˜ê±°ë‚˜ API í‚¤ë¥¼ ì ê²€í•˜ì„¸ìš”.");
                }
                setBlogLoading(false);
            };

            // --- ë°ì´í„° í•„í„°ë§ ë¡œì§ ---
            const getFilteredBlogData = () => {
                let data = blogData;
                
                // 1. í‚¤ì›Œë“œ í•„í„°
                if (selectedKeyword !== "ALL") {
                    data = data.filter(item => item.keyword === selectedKeyword);
                }

                // 2. ê¸°ê°„ í•„í„°
                if (periodFilter === 'recent') data = data.filter(i => i.daysAgo <= 30);
                else if (periodFilter === 'revisit') data = data.filter(i => i.daysAgo > 30 && i.daysAgo <= 90);
                else if (periodFilter === 'long') data = data.filter(i => i.daysAgo > 90 && i.daysAgo <= 180);
                else if (periodFilter === 'old') data = data.filter(i => i.daysAgo > 180);

                return data;
            };

            // --- ë Œë”ë§ ---
            return (
                <div className="max-w-7xl mx-auto p-4">
                    {/* Header */}
                    <div className="mb-8">
                        <h1 className="text-3xl font-bold text-blue-400">HOSPITAL MARKETING PRO</h1>
                        <p className="text-gray-400">Data-Driven Marketing Intelligence Dashboard (JS Edition)</p>
                    </div>

                    {/* API Key Settings */}
                    <div className="card mb-6">
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">ğŸ”‘ API í‚¤ ì„¤ì • (ë³´ì•ˆ: ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë¨)</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" placeholder="Naver Client ID" value={apiKeys.naverId} onChange={e => setApiKeys({...apiKeys, naverId: e.target.value})} />
                            <input type="password" placeholder="Naver Client Secret" value={apiKeys.naverSecret} onChange={e => setApiKeys({...apiKeys, naverSecret: e.target.value})} />
                            <input type="password" placeholder="YouTube API Key" value={apiKeys.youtubeKey} onChange={e => setApiKeys({...apiKeys, youtubeKey: e.target.value})} />
                        </div>
                        <p className="text-xs text-red-400 mt-2">* CORS ì—ëŸ¬ ë°œìƒ ì‹œ í¬ë¡¬ í™•ì¥í”„ë¡œê·¸ë¨(Allow CORS)ì„ í™œì„±í™”í•´ì•¼ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>

                    {/* Tabs */}
                    <div className="flex w-full bg-[#0E1117] border-b border-gray-700 mb-6">
                        {['ìƒê¶Œ ë¶„ì„(Beta)', 'ë¸”ë¡œê·¸ ë¶„ì„', 'ìœ íŠœë¸Œ ë¶„ì„', 'ì¸ìŠ¤íƒ€ ë¶„ì„', 'ë‚´ ì±„ë„ ì„±ê³¼'].map((tab, idx) => {
                            const tabKey = ['loc', 'blog', 'yt', 'insta', 'my'][idx];
                            return (
                                <button 
                                    key={tabKey}
                                    onClick={() => setActiveTab(tabKey)}
                                    className={`flex-1 py-3 text-center transition-colors ${activeTab === tabKey ? 'tab-active' : 'tab-inactive hover:text-gray-300'}`}
                                >
                                    {tab}
                                </button>
                            )
                        })}
                    </div>

                    {/* Content: Blog Tab */}
                    {activeTab === 'blog' && (
                        <div className="card">
                            <div className="premium-box mb-6">
                                <h4 className="font-bold text-lg mb-2">ğŸ’¡ Insight</h4>
                                <p>ì„ íƒí•˜ì‹  ì¹´í…Œê³ ë¦¬ì˜ <b>ì—°ê´€ ì„¸ë¶€ ì‹œìˆ ëª…(ex. ìš¸ì„ë¼, ì¸ëª¨ë“œ ë“±)</b>ê¹Œì§€ ìë™ìœ¼ë¡œ í™•ì¥ ê²€ìƒ‰í•˜ì—¬, ìˆ¨ê²¨ì§„ <b>ìƒìœ„ ë…¸ì¶œ ë¸”ë¡œê±°</b>ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p>
                            </div>

                            {/* Search Form */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end">
                                <div>
                                    <label className="block text-gray-400 text-sm mb-1">ì§€ì—­ëª…</label>
                                    <input type="text" value={blogInputs.region} onChange={e => setBlogInputs({...blogInputs, region: e.target.value})} />
                                </div>
                                <div>
                                    <label className="block text-gray-400 text-sm mb-1">ì¹´í…Œê³ ë¦¬</label>
                                    <select value={blogInputs.category} onChange={e => setBlogInputs({...blogInputs, category: e.target.value})}>
                                        {Object.keys(KEYWORD_EXPANSION).map(k => <option key={k} value={k}>{k}</option>)}
                                    </select>
                                </div>
                                <button onClick={fetchBlogs} className="btn-primary w-full h-[46px] rounded-md font-bold">
                                    {blogLoading ? 'ë¶„ì„ ì¤‘...' : 'ğŸ“Š í†µí•© ë¶„ì„ ì‹œì‘'}
                                </button>
                            </div>

                            {/* Keywords Grid */}
                            {blogData.length > 0 && (
                                <div className="mb-6">
                                    <h5 className="text-gray-300 font-bold mb-3">ğŸ“‚ ë¶„ì„í•  í‚¤ì›Œë“œ ì„ íƒ (í•„í„° ìœ ì§€ë¨)</h5>
                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                                        <button 
                                            onClick={() => setSelectedKeyword("ALL")}
                                            className={`p-2 rounded text-sm ${selectedKeyword === "ALL" ? 'btn-active' : 'btn-secondary'}`}
                                        >
                                            ALL (í†µí•© ë¶„ì„)
                                        </button>
                                        {[...new Set(blogData.map(d => d.keyword))].map(k => (
                                            <button 
                                                key={k} 
                                                onClick={() => setSelectedKeyword(k)}
                                                className={`p-2 rounded text-sm truncate ${selectedKeyword === k ? 'btn-active' : 'btn-secondary'}`}
                                            >
                                                {k}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Period Filter */}
                            {blogData.length > 0 && (
                                <div className="flex flex-wrap gap-4 mb-4 items-center bg-[#0D1117] p-3 rounded border border-[#30363D]">
                                    <span className="text-gray-400 font-bold text-sm">â³ ì‘ì„± ì‹œê¸°:</span>
                                    {[
                                        {k: 'all', l: 'ì „ì²´'},
                                        {k: 'recent', l: 'ğŸ”´ ìµœì‹ ê¸€ (1ë‹¬ë‚´)'},
                                        {k: 'revisit', l: 'ì¬ë°©ë¬¸ (1~3ë‹¬)'},
                                        {k: 'long', l: 'ì¥ê¸° (3~6ë‹¬)'},
                                        {k: 'old', l: 'ì´íƒˆ (6ë‹¬+)'}
                                    ].map(f => (
                                        <label key={f.k} className="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                type="radio" 
                                                name="period" 
                                                checked={periodFilter === f.k} 
                                                onChange={() => setPeriodFilter(f.k)}
                                                className="w-4 h-4"
                                            />
                                            <span className={`text-sm ${periodFilter === f.k ? 'text-white font-bold' : 'text-gray-500'}`}>{f.l}</span>
                                        </label>
                                    ))}
                                </div>
                            )}

                            {/* Result Table */}
                            {blogLoading ? (
                                <div className="py-10 text-center"><div className="loader"></div><p className="mt-4 text-gray-400">ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p></div>
                            ) : (
                                <div className="overflow-x-auto">
                                    {blogData.length > 0 ? (
                                        <>
                                            <p className="mb-2 text-sm text-gray-400">ê²€ìƒ‰ëœ ë¸”ë¡œê·¸: <span className="text-white font-bold">{getFilteredBlogData().length}</span>ê±´</p>
                                            <table className="w-full">
                                                <thead>
                                                    <tr>
                                                        <th>Rank</th>
                                                        <th>ë¸”ë¡œê·¸ ì§€ìˆ˜</th>
                                                        <th>Type</th>
                                                        <th>ë¸”ë¡œê·¸ëª…</th>
                                                        <th>ì œëª©</th>
                                                        <th>ì‘ì„±ì¼</th>
                                                        <th>ë§í¬</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {getFilteredBlogData().map((item, i) => (
                                                        <tr key={i}>
                                                            <td className="font-bold">{item.rank}</td>
                                                            <td>
                                                                <span className={`text-xs px-2 py-1 rounded ${item.tier.includes('S') ? 'bg-red-900 text-red-200' : item.tier.includes('A') ? 'bg-blue-900 text-blue-200' : 'bg-gray-700'}`}>
                                                                    {item.tier}
                                                                </span>
                                                            </td>
                                                            <td className="text-xs text-gray-400">{item.type}</td>
                                                            <td className="text-gray-300 truncate max-w-[100px]">{item.blogName}</td>
                                                            <td className="text-white truncate max-w-[250px]">{item.title}</td>
                                                            <td className="text-gray-400 text-xs">{item.postdate} ({item.daysAgo}ì¼ì „)</td>
                                                            <td><a href={item.link} target="_blank">ë³´ê¸°</a></td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </>
                                    ) : (
                                        <div className="text-center py-10 text-gray-500">
                                            ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    )}

                    {/* Placeholder for other tabs */}
                    {activeTab !== 'blog' && (
                        <div className="card text-center py-20">
                            <h3 className="text-xl font-bold mb-4">ğŸš§ {activeTab.toUpperCase()} ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘</h3>
                            <p className="text-gray-400">ì´ íŒŒì¼ì€ 'ë¸”ë¡œê·¸ ë¶„ì„' ê¸°ëŠ¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br/>ìœ íŠœë¸Œ/ì¸ìŠ¤íƒ€ ê¸°ëŠ¥ë„ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ API í‚¤ë¥¼ ì—°ê²°í•˜ì—¬ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
